---
title: "PA1_template"
author: "jpeyto"
date: "8 July 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
require("data.table")
require("lattice")
require("ggplot2")
require("reshape2")
require("dplyr")
require("zoo")
```

## Loading and preprocessing the data

```{r load_data}
  if(!file.exists("activity.csv")) {
    if(!file.exists("repdata%2Fdata%2Factivity.zip")) {
      fileURL <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip"
      download.file(fileURL, "repdata%2Fdata%2Factivity.zip")
    } 
    unzip("repdata%2Fdata%2Factivity.zip")
  } 
  data<-read.csv("activity.csv")
  data<-mutate(data, date=as.POSIXct(data.frame$date,format="%Y-%m-%d", tz="GMT"))
```

## What is mean total number of steps taken per day?
```{r steps_per_day}
  total_steps<-tapply(data$steps, data$date, sum)
  hist(total_steps)
  mean(total_steps, na.rm=TRUE)
  median(total_steps, na.rm=TRUE)
```

## What is the average daily activity pattern?
```{r steps_per_interval}
  interval_steps<-tapply(data$steps, data$interval, mean, na.rm=TRUE)
  plot(unique(data$interval), interval_steps, type="l", xaxt="n")
  axis(side=1, at = unique(data$interval)[seq(13,288,12)])
  interval_steps[which.max(interval_steps)]
```


## Imputing missing values
```{r na}
  sum(is.na(data$steps))
  #na_data<-dcast(data, interval ~ date)
  #interpolated<-na.approx(data, rule=2)
  d2<-mutate(data, total=seq(0,17568*5-1,5))
  d3<-na.approx(d2[,c(4,1)], rule=2)
  interp<-mutate(data, steps=d3[,2])
  #
  interval_steps<-tapply(interp$steps, interp$interval, mean, na.rm=TRUE)
  plot(unique(interp$interval), interval_steps, type="l", xaxt="n")
  axis(side=1, at = unique(interp$interval)[seq(13,288,12)])
  interval_steps[which.max(interval_steps)]
```

## Are there differences in activity patterns between weekdays and weekends?